!function(){var t={getDateStr:function(t){var a=t.getFullYear(),e=t.getMonth()+1,i=t.getDate();return e=10>e?"0"+e:e,i=10>i?"0"+i:i,a+"-"+e+"-"+i},buildData:function(t){for(var a=this,e=[],i=new Date("2016-01-01"),r="",n=1;92>n;n++)r=a.getDateStr(i),i.setDate(i.getDate()+1),e.push({time:r,airQuatity:Math.ceil(Math.random()*t),day:1});return e}},a={"北京":t.buildData(500),"上海":t.buildData(300),"广州":t.buildData(200),"深圳":t.buildData(100),"成都":t.buildData(300),"西安":t.buildData(500),"福州":t.buildData(100),"厦门":t.buildData(100),"沈阳":t.buildData(500)},e={colorData:{},chartData:{},rectangleWidth:{day:"15px",week:"50px",month:"100px"},pageState:{nowSelectCity:"北京",nowGraTime:"day"},init:function(){var t=this;t.initGraTimeForm(),t.initCitySelector(),t.initAqiChartData(),t.renderChart()},graTimeChange:function(t){for(var a=this,e=0,i=t.length;i>e;e++)t[e].onclick=function(){this.checked&&(a.pageState.nowGraTime=this.value,a.initAqiChartData(),a.renderChart())}},citySelectChange:function(t){for(var a=t.getElementsByTagName("option"),e=this,i=0,r=a.length;r>i;i++)a[i].selected&&(e.pageState.nowSelectCity=a[i].value,e.initAqiChartData(),e.renderChart())},chartItemMouseOver:function(t){for(var a=this,e=0,i=t.length;i>e;e++)t[e].onmouseover=function(t){return function(){var e="<span>时间："+a.chartData.result[t].time+"<br>空气质量："+a.chartData.result[t].airQuatity+"</span>";this.innerHTML=e}}(e),t[e].onmouseout=function(){this.innerHTML=""}},initGraTimeForm:function(){var t=document.getElementsByName("gra-time");this.graTimeChange(t)},initCitySelector:function(){var t=this,a=document.getElementById("city-select");a.onchange=function(){t.citySelectChange(a)}},initAqiChartData:function(){var t=this,e=a[t.pageState.nowSelectCity],i=t.rectangleWidth[t.pageState.nowGraTime],r=[],n=e.length,o="",h=0,c="",l="",u=0;if("day"===t.pageState.nowGraTime&&(r=e,o="0 4"),"week"===t.pageState.nowGraTime){for(var g=0;n>g;g++)0===u&&(c=e[g].time),t.getDay(e[g].time)<7&&(h+=e[g].airQuatity,u++),7!==t.getDay(e[g].time)&&g!==n-1||(u++,l=e[g].time,h+=e[g].airQuatity,r.push({time:c+"到"+l,airQuatity:(h/u).toFixed(2),day:u}),h=0,u=0);o="0 8"}if("month"===t.pageState.nowGraTime){for(var m=0,s=0;n>s;s++)flag=t.getMonth(e[s].time),(0!==s&&t.getMonth(e[s-1].time)!==flag||s===n-1)&&(r.push({time:t.getYear(e[s-1].time)+"年"+t.getMonth(e[s-1].time)+"月",airQuatity:(h/m).toFixed(2),day:m}),h=0,m=0),h+=e[s].airQuatity,m++;o="0 15"}t.randomColor(r.length),t.chartData={color:t.colorData,result:r,width:i,margin:o},console.log(t.chartData)},getDay:function(t){return new Date(Date.parse(t)).getDay()+1},getMonth:function(t){return new Date(Date.parse(t)).getMonth()+1},getYear:function(t){return new Date(Date.parse(t)).getFullYear()},randomColor:function(t){for(var a=this,e=0;t>e;e++){var i;i=Math.floor(16777216*Math.random()),i=i.toString(16),i=("000000"+i).slice(-6),i="#"+i,a.colorData[e]||(a.colorData[e]=i)}},renderChart:function(){for(var t=document.getElementById("aqi-chart-wrap"),a=this,e="",i=a.chartData.result,r=0,n=i.length;n>r;r++)e+="<i style='background-color:"+a.chartData.color[r.toString()]+";width:"+a.chartData.width+";height:"+i[r].airQuatity+"px;margin:"+a.chartData.margin+"px;z-index:"+(n-r)+";' class='flex-items'></i>";t.innerHTML=e;var o=t.getElementsByClassName("flex-items");a.chartItemMouseOver(o)}};e.init()}();